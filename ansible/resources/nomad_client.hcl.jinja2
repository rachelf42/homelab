data_dir  = "/opt/nomad/data"
bind_addr = "0.0.0.0"
datacenter = "dc1"

advertise {
  http = "{{ ip_address }}"
  rpc  = "{{ ip_address }}"
  serf = "{{ ip_address }}"
}

acl {
  enabled = true
}

client {
  enabled = true
  host_volumes_dir =  "/mount/nas/appdata"
  host_volume "media-library" {
    # https://stackoverflow.com/questions/68833889/mounting-volumes-in-docker-via-nomad
    path = "/mount/nas/media"
  }
  options {
    "driver.raw_exec.enable"    = "1"
    "docker.privileged.enabled" = "true"
    "docker.volumes.enabled" = "true"
  }
  server_join {
    retry_join = [
      {% for host in groups['nomad_server'] %}
        "{{ hostvars[host].ip_address }}"{{ ", " if not loop.last else "" }}
      {% endfor %}
    ]
  }
}
