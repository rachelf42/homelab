data_dir  = "/opt/nomad/data"
bind_addr = "0.0.0.0"
datacenter = "dc1"

advertise {
  http = "{{ ip_address }}"
  rpc  = "{{ ip_address }}"
  serf = "{{ ip_address }}"
}

acl {
  enabled = true
}

server {
  enabled          = true
  bootstrap_expect = {{ nomad_svrcount }}

  server_join {
    retry_join = [
      {% for host in groups['nomad_server'] %}
        "{{ hostvars[host].ip_address }}"{{ ", " if not loop.last else "" }}
      {% endfor %}
    ]
  }
}
