########## STACK SETTINGS
name: jenkins
networks:
  main:
########## SERVICES
services:
  terraform:
    extends:
      file: ./common.compose.yaml
      service: base
    image: hashicorp/tfc-agent:1.22.3@sha256:4e9ce327224015be27b24d8798c153b00f48e1c9d9b4e79f073efdb310c74d22
    environment:
      TFC_AGENT_NAME: jenkins
      TFC_AGENT_AUTO_UPDATE: disabled # let renovate do it
      TFC_AGENT_SINGLE: true
    env_file: ./secrets/terraform_agent_token.env
    restart: always
    healthcheck: !reset {} # dont know why but dclint needs this not null
  webhookrelay:
    extends:
      file: ./common.compose.yaml
      service: base-nonet
    image: webhookrelay/webhookrelayd:1.34.2@sha256:c74a64c4ed5e54814ec5fe17c976c393975c81fceee89cfcf944da155370996c
    environment:
      BUCKETS: github-jenkins
    env_file: ./secrets/webhookrelay_agent_token.env
    network_mode: host
    healthcheck: !reset {}