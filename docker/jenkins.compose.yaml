########## STACK SETTINGS
name: jenkins
networks:
  main:
########## SERVICES
services:
  dozzle:
    extends:
      file: ./common.compose.yaml
      service: dozzle-agent
  terraform:
    extends:
      file: ./common.compose.yaml
      service: base
    image: hashicorp/tfc-agent:1.24.0@sha256:9fb5406b5f5b611fb502aad47444de326813650f160ddc7583e4b16fad99ced2
    environment:
      TFC_AGENT_NAME: jenkins
      TFC_AGENT_AUTO_UPDATE: disabled # let renovate do it
      TFC_AGENT_SINGLE: true
    env_file: ./secrets/terraform_agent_token.env
    restart: always
    healthcheck: !reset {} # dont know why but dclint needs this not null
  webhookrelay:
    extends:
      file: ./common.compose.yaml
      service: base-nonet
    image: webhookrelay/webhookrelayd:1.34.4@sha256:5e947c3aa1d795437d9a108649bce66cba553eb444584e33bff5f28f2de28df1
    environment:
      BUCKETS: github-jenkins
    env_file: ./secrets/webhookrelay_agent_token.env
    network_mode: host
    healthcheck: !reset {}